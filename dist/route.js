const router=require("express").Router(),{User,Pet}=require("../models"),withAuth=require("../utils/withAuth");router.get("/",withAuth,async(a,b)=>{try{const c=await User.findByPk(a.session.user_id,{attributes:{exclude:["password"]},include:[{model:Pet}]}),d=c.get({plain:!0});b.render("dashboard",{user:d,logged_in:a.session.logged_in})}catch(a){b.status(500).json(a.message)}}),router.get("/:id",async(a,b)=>{try{const c=await User.findByPk(a.params.id,{include:[{model:Pet,attributes:["pet_name"]}]});b.status(200).json(c)}catch(a){b.json(a)}}),router.patch("/",async(a,b)=>{console.log(a.body),console.log(a.body.species),console.log(a.body.zip),console.log(a.session.user_id);try{const c=await User.update({species:a.body.species,zip:a.body.zip},{where:{id:a.session.user_id}});c||b.status(404).json({message:"No user with this id found!"}),b.status(200).json(c)}catch({message:a}){console.log(a),b.status(500).json({message:a})}}),module.exports=router;